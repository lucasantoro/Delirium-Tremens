<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Abyss Chosen – Progress</title>
<link rel="stylesheet" href="../../css/style.css">

<style>
body {
  background: #0b0b0b;
  color: #ccc;
  font-family: Arial, sans-serif;
  margin: 0;
}

/* HEADER */
header {
  text-align: center;
  padding: 25px 0 10px;
}
header h1 {
  color: #fff;
  font-size: 2.4rem;
  text-shadow: 0 0 12px rgba(255,80,80,0.5);
  margin: 0;
}
header nav ul {
  list-style: none;
  display: flex;
  justify-content: center;
  gap: 25px;
  padding: 0;
  margin-top: 15px;
}
header nav a {
  color: #fff;
  text-decoration: none;
  font-size: 1.1rem;
  transition: .3s;
}
header nav a:hover,
header nav a.active {
  color: #ff5050;
  text-shadow: 0 0 8px #ff5050;
}

/* HERO */
.hero-progress {
  padding: 50px 20px 30px;
  text-align: center;
}
.hero-progress h2 {
  font-size: 2.4rem;
  color: #fff;
  animation: fadeUp .9s ease forwards;
}
.hero-progress p {
  max-width: 700px;
  margin: 18px auto 0;
  color: #ccc;
  font-size: 1.2rem;
  animation: fadeUp 1.2s ease forwards;
}

/* Fade */
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* BACKGROUND CON LOGO */
.bg-container {
  position: relative;
  background: url('../../img/logo.png') center/cover no-repeat;
  padding: 60px 0 80px;
}
.bg-container::after {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(2px);
}
.bg-container > * { position: relative; z-index: 2; }


/* SEZIONI */
.section-title {
  text-align: center;
  color: #fff;
  font-size: 2rem;
  margin-bottom: 10px;
}

.progress-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  gap: 25px;
  margin-top: 30px;
}

/* CARD BOSS */
.boss-card {
  background: rgba(15,15,15,0.8);
  padding: 20px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.15);
  box-shadow: 0 0 15px rgba(255,80,80,0.35);
  backdrop-filter: blur(4px);
  transition: .3s;
  animation: fadeZoom .7s ease forwards;
}
@keyframes fadeZoom {
  from { opacity: 0; transform: scale(0.95); }
  to   { opacity: 1; transform: scale(1); }
}
.boss-card:hover {
  border-color: #ff5050;
  box-shadow: 0 0 22px rgba(255,80,80,0.55);
}

/* STATUS */
.status {
  padding: 6px 10px;
  border-radius: 6px;
  font-weight: bold;
  display: inline-block;
  margin-bottom: 10px;
}
.status-killed {
  background: rgba(80,255,120,0.25);
  color: #9fffba;
}
.status-progress {
  background: rgba(255,200,80,0.25);
  color: #ffeab4;
}
.status-unknown {
  background: rgba(180,180,180,0.25);
  color: #ddd;
}

.boss-name {
  color: #fff;
  font-size: 1.4rem;
  margin-bottom: 10px;
}
.boss-info {
  color: #ccc;
  margin: 4px 0;
}

footer {
  text-align: center;
  padding: 30px 0;
  color: #777;
}
</style>
</head>


<body>

<header>
  <h1>Abyss Chosen</h1>
  <nav>
    <ul>
      <li><a href="../../index.html">Home</a></li>
      <li><a href="../raider.html">Raider</a></li>
      <li><a href="../hollowsoul.html">Hollow Soul</a></li>
      <li><a href="../recruiting.html">Reclutamento</a></li>
      <li><a href="../statuto.html">Statuto</a></li>
    </ul>
  </nav>
</header>

<section class="hero-progress">
  <h2>Progress Raid – Abyss Chosen</h2>
  <p>
    Stato aggiornato dei boss in Normal, Heroic e Mythic per il tier corrente,
    con dati ufficiali da Warcraft Logs.
  </p>
</section>

<div class="bg-container">
  <main class="panel">

    <h2 class="section-title">Progress Mythic</h2>
    <div id="mythic-progress" class="progress-grid"></div>

    <h2 class="section-title">Progress Heroic</h2>
    <div id="heroic-progress" class="progress-grid"></div>

    <h2 class="section-title">Progress Normal</h2>
    <div id="normal-progress" class="progress-grid"></div>

  </main>
</div>


<footer>
  <p>&copy; 2025 Delirium Tremens</p>
</footer>


<script>
/* ================
   CONFIGURAZIONE
================ */
const CLIENT_ID = "YOUR_CLIENT_ID_HERE";
const CLIENT_SECRET = "YOUR_CLIENT_SECRET_HERE";
const GUILD_ID = 802526;   
const ZONE_ID = 44;        // Tier attuale


/* =============
   OTTENERE TOKEN
=============== */
async function getToken() {
  const res = await fetch("https://www.warcraftlogs.com/oauth/token", {
    method: "POST",
    headers: {"Content-Type": "application/x-www-form-urlencoded"},
    body: `grant_type=client_credentials&client_id=${CLIENT_ID}&client_secret=${CLIENT_SECRET}`
  });
  const data = await res.json();
  return data.access_token;
}


/* ==========================
   QUERY GRAPHQL BOSS STATUS
=========================== */
const QUERY = `
query ($guildId: Int!, $zoneId: Int!, $difficulty: Int!) {
  guildData {
    guild(id: $guildId) {
      zoneRankings(zoneID: $zoneId, difficulty: $difficulty) {
        rankings {
          encounter {
            id
            name
          }
          totalKills
          bestPercentage
          bestDuration
        }
      }
    }
  }
}
`;


/* =====================
   FUNZIONE CHIAVE
   OTTIENE PROGRESS PER DIFFICOLTÀ
===================== */
async function loadProgress(difficulty, containerId) {

  const token = await getToken();

  const res = await fetch("https://www.warcraftlogs.com/api/v2/client", {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + token,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      query: QUERY,
      variables: {
        guildId: GUILD_ID,
        zoneId: ZONE_ID,
        difficulty: difficulty
      }
    })
  });

  const json = await res.json();
  const bosses = json.data.guildData.guild.zoneRankings.rankings;

  const container = document.getElementById(containerId);
  container.innerHTML = "";

  bosses.forEach(b => {

    let statusClass = "status-unknown";
    let statusText = "Non iniziato";

    if (b.totalKills > 0) {
      statusClass = "status-killed";
      statusText = "Kill";
    } else if (b.bestPercentage < 100 && b.bestPercentage !== null) {
      statusClass = "status-progress";
      statusText = "Progress";
    }

    const card = document.createElement("div");
    card.className = "boss-card";
    card.innerHTML = `
      <span class="status ${statusClass}">${statusText}</span>
      <div class="boss-name">${b.encounter.name}</div>
      <div class="boss-info"><strong>Best %:</strong> ${b.bestPercentage ?? "-"}%</div>
      <div class="boss-info"><strong>Kill:</strong> ${b.totalKills}</div>
      <div class="boss-info"><strong>Miglior tempo:</strong> ${b.bestDuration ? (b.bestDuration/1000).toFixed(1) + "s" : "-"}</div>
    `;
    container.appendChild(card);
  });

}


/* =====================
   CARICAMENTO PAGINA
===================== */
loadProgress(5, "mythic-progress");  // Mythic
loadProgress(4, "heroic-progress");  // Heroic
loadProgress(3, "normal-progress");  // Normal
</script>

</body>
</html>
